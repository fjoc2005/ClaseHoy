<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>ClaseHoy</title>
    <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>

<div class="auth-container">
    <div class="auth-card">
        <h1>ClaseHoy</h1>
        <p>Profesores disponibles para reemplazos inmediatos</p>
        <br>

        <div id="posts-container"></div>
    </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
<script src="assets/js/firebase-config.js"></script>

<script>
document.addEventListener("DOMContentLoaded", () => {

    const postsContainer = document.getElementById("posts-container");

    const now = firebase.firestore.Timestamp.now();

    db.collection("posts")
      .where("expiresAt", ">", now)
      .orderBy("expiresAt")
      .onSnapshot(snapshot => {

        postsContainer.innerHTML = "";

        if (snapshot.empty) {
            postsContainer.innerHTML = "<p>No hay avisos activos.</p>";
            return;
        }

        snapshot.forEach(doc => {
            const post = doc.data();

            const postDiv = document.createElement("div");
            postDiv.style.border = "1px solid #ddd";
            postDiv.style.padding = "10px";
            postDiv.style.marginBottom = "10px";

            postDiv.innerHTML = `
                <h3>${post.nombre}</h3>
                <p><strong>${post.profesion}</strong></p>
                <p>${post.region} - ${post.comuna}</p>
                <p>${post.disponibilidad}</p>
                <div id="contact-${doc.id}"></div>
            `;

            postsContainer.appendChild(postDiv);

            firebase.auth().onAuthStateChanged(user => {
                const contactDiv = document.getElementById(`contact-${doc.id}`);

                if (user) {
                    contactDiv.innerHTML = `
                        <p><strong>Contacto:</strong> ${post.email}</p>
                    `;
                } else {
                    contactDiv.innerHTML = `
                        <p style="color:gray;">Inicia sesi√≥n para ver el contacto</p>
                    `;
                }
            });

        });

    });

});
</script>

</body>
</html>
